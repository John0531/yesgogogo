<template>
  <div>
    <div class="container">
      <button class="btn btn-success login p-5 fs-2" @click="myModal.show()" v-if="!islogin">
        登入
      </button>
      <button class="btn btn-info p-5 fs-2 ms-3" @click="myOldModal.show()" v-if="!islogin">
        舊會員登入
      </button>
      <button class="btn btn-primary p-5 fs-2 ms-3" @click="logout" v-if="islogin">
        登出
      </button>
      <div class="mt-3">
        <span v-if="islogin" class="fs-3 text-success">已登入</span>
        <span v-else class="fs-3 text-danger">未登入</span>
      </div>
      <div>
        <button
          v-if="!$store.state.registerMsgSecond"
          class="btn btn-primary p-5 fs-2 ms-3"
          @click="countMsg"
        >
          獲取驗證碼
        </button>
        <button v-else class="btn btn-primary p-5 fs-2 ms-3" disabled>
          {{ $store.state.registerMsgSecond }}
        </button>
      </div>
      <div class="row justify-content-center my-5">
        <div class="col-lg-10">
          <div class="row">
            <div class="col-md-6">
              <Form
                class="form_registration pe-lg-4 pe-md-3"
                v-slot="{ errors }"
                @submit="register"
              >
                <div class="title">
                  <span class="registraion text-primary fs-5">會員註冊</span>
                </div>
                <div class="form_detail mt-4">
                  <div class="row name d-flex align-items-end">
                    <div class="col-md-12 mb-3">
                      <label for="inputEmail4" class="form-label">姓名</label>
                      <span class="text-primary">*</span>
                      <Field
                        name="姓名"
                        placeholder="姓名"
                        class="form-control py-2"
                        :class="{ 'is-invalid': errors['姓名'] }"
                        v-model="form.FullName"
                        autocomplete="off"
                        :rules="checkName"
                      ></Field>
                      <ErrorMessage
                        name="姓名"
                        class="invalid-feedback"
                      ></ErrorMessage>
                    </div>
                  </div>
                  <div class="row email">
                    <div class="col-md-12 mb-3">
                      <label for="inputAddress" class="form-label"
                        >電子郵件</label
                      >
                      <span class="text-primary">*</span>
                      <Field
                        name="信箱"
                        placeholder="請輸入email"
                        type="text"
                        class="form-control py-2"
                        id="memberEmail"
                        autocomplete="off"
                        :class="{ 'is-invalid': errors['信箱'] }"
                        v-model="form.Email"
                        :rules="checkEmail"
                      ></Field>
                      <ErrorMessage
                        name="信箱"
                        class="invalid-feedback"
                      ></ErrorMessage>
                      <p class="text-primary">{{ checkEmailMsg }}</p>
                    </div>
                  </div>
                  <div class="row phone">
                    <div class="col-md-12">
                      <label class="form-label">手機</label>
                      <span class="text-primary">*</span>
                      <Field
                        name="手機"
                        type="tel"
                        class="form-control py-2"
                        placeholder="請輸入手機號碼"
                        autoCompleteType="disabled"
                        :class="{ 'is-invalid': errors['手機'] }"
                        v-model="form.PhoneNum"
                        autocomplete="off"
                        :rules="isPhone"
                      ></Field>
                      <ErrorMessage
                        name="手機"
                        class="invalid-feedback"
                      ></ErrorMessage>
                      <span id="uidt" class="text-primary"></span>
                    </div>
                  </div>
                  <div class="row verification mt-2">
                    <div class="col-md-7 col-lg-7 mb-1">
                      <Field
                        name="手機驗證碼"
                        type="number"
                        class="form-control py-2"
                        placeholder="請輸入驗證碼(每日限定傳送3次)"
                        autoCompleteType="disabled"
                        autocomplete="off"
                        :class="{ 'is-invalid': errors['手機驗證碼'] }"
                        v-model="form.OtpCode"
                        rules="required"
                      ></Field>
                      <ErrorMessage
                        name="手機驗證碼"
                        class="invalid-feedback"
                      ></ErrorMessage>
                    </div>
                    <div class="col-md-5 col-lg-5 mb-3">
                      <button
                        type="submit"
                        class="btn btn-primary"
                        @click.prevent="countMsg"
                        :disabled="$store.state.registerMsgSecond"
                      >
                        <span v-if="!$store.state.registerMsgSecond"
                          >獲取驗證碼</span
                        >
                        <span v-else class="count"
                          >{{ $store.state.registerMsgSecond }} 秒後
                          重新發送</span
                        >
                      </button>
                    </div>
                  </div>
                  <div class="row password">
                    <div class="col-md-12 mb-3">
                      <label class="form-label" for="newPassword">密碼</label>
                      <span class="text-primary">*</span>
                      <div id="f">
                        <Field
                          name="密碼"
                          type="password"
                          class="form-control form_password py-2"
                          placeholder="至少6碼且英數字混合"
                          :class="{ 'is-invalid': errors['密碼'] }"
                          autocomplete="off"
                          v-model="form.SecretCode"
                          id="newPassword"
                          :rules="checkPwdRule"
                        ></Field>
                        <ErrorMessage
                          name="密碼"
                          class="invalid-feedback"
                        ></ErrorMessage>
                        <a
                          href="#"
                          class="passwordImage position-absolute d-block"
                        >
                          <img
                            src="../assets/img/yesgo_icon26.svg"
                            v-if="isOldShow"
                          />
                          <img v-else src="../assets/img/yesgo_icon25.svg" />
                        </a>
                      </div>
                      <p class="text-primary">{{ password }}</p>
                    </div>
                  </div>
                  <div class="row doublecheck">
                    <div class="col-md-12 mb-3">
                      <label for="confirmPassword" class="form-label"
                        >確認密碼</label
                      >
                      <span class="text-primary">*</span>
                      <div id="f">
                        <Field
                          name="確認密碼"
                          type="password"
                          class="form-control form_confirm_password py-2"
                          placeholder="至少6碼且英數字混合"
                          :class="{ 'is-invalid': errors['確認密碼'] }"
                          autocomplete="off"
                          v-model="confirmPassword"
                          id="confirmPassword"
                          :rules="confirmPwd"
                        ></Field>
                        <ErrorMessage
                          name="確認密碼"
                          class="invalid-feedback"
                        ></ErrorMessage>
                        <a
                          href="#"
                          @click.prevent="pwdCheck(isConfirmShow, $event)"
                          class="passwordImage position-absolute d-block"
                        >
                          <img
                            v-if="isConfirmShow"
                            src="../assets/img/yesgo_icon26.svg"
                          />
                          <img v-else src="../assets/img/yesgo_icon25.svg" />
                        </a>
                      </div>
                      <p class="text-primary">{{ confirmNotSame }}</p>
                    </div>
                  </div>
                  <div class="row verificationCode">
                    <div class="col-md-12">
                      <label for="inputState" class="form-label">驗證碼</label>
                      <div class="input-group">
                        <Field
                          name="驗證碼"
                          :class="{ 'is-invalid': errors['驗證碼'] }"
                          autocomplete="off"
                          type="text"
                          class="form-control z-index-10"
                          maxlength="4"
                          tabindex="3"
                          v-model="form.Captcha"
                          rules="required"
                        />
                        <button
                          class="verifyBtn btn border px-3"
                          type="button"
                          @click.prevent="getValidCode"
                        >
                          <img
                            :src="validate.img"
                            style="width: 100px; height: 30px; margin-right: 8px;"
                          />
                          <img src="../assets/img/yesgo_icon27.svg" />
                        </button>
                        <ErrorMessage
                          name="驗證碼"
                          class="invalid-feedback"
                        ></ErrorMessage>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex justify-content-end text-muted fs-7 mt-1">
                    驗證碼不須區分大小寫
                  </div>
                  <div class="row mt-2">
                    <div class="col-md-12 mt-3">
                      <div class="form-check">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          checked
                          id="newsFormCheck"
                          v-model="form.IsSubscribe"
                        />
                        <label
                          for="newsFormCheck"
                          class="form-check-label mt-1"
                        >
                          我願意收到yesgogogo電子報
                        </label>
                      </div>
                    </div>
                  </div>
                  <div class="row term">
                    <div class="col-md-12">
                      <div class="form-check">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          id="inlineFormCheck2"
                          v-model="terms"
                        />
                        <label class="form-check-label" for="inlineFormCheck2" >
                          我已詳閱並同意
                          <router-link to="/rights" class="text-primary"
                            >約定條款</router-link
                          >
                          以確保權益
                        </label>
                      </div>
                      <div class="confirm mt-2">
                        <button type="submit" class="btn btn-primary">
                          確認
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </Form>
            </div>
            <div class="col-md-6">
              <Form
                class="form_registration pe-lg-4 pe-md-3"
                v-slot="{ errors }"
                @submit="cardRegister"
              >
                <div class="title">
                  <span class="registraion text-primary fs-5"
                    >聯邦卡友專屬會員註冊</span
                  >
                </div>
                <div class="form_detail">
                  <div class="row phone">
                    <div class="col-md-12">
                      <label class="form-label">會員帳號(手機號碼)</label>
                      <span class="text-primary">*</span>
                      <Field
                        name="手機"
                        type="tel"
                        class="form-control"
                        placeholder="請輸入手機號碼"
                        autoCompleteType="disabled"
                        :class="{ 'is-invalid': errors['手機'] }"
                        v-model="cardForm.PhoneNum"
                        autocomplete="off"
                        :rules="isPhone"
                      ></Field>
                      <ErrorMessage
                        name="手機"
                        class="invalid-feedback"
                      ></ErrorMessage>
                      <span id="uidt" class="text-primary"></span>
                    </div>
                  </div>
                  <div class="row verification">
                    <div class="col-md-7 mt-1">
                      <Field
                        name="手機驗證碼"
                        type="number"
                        class="form-control"
                        placeholder="請輸入驗證碼(每日限定傳送3次)"
                        autoCompleteType="disabled"
                        autocomplete="off"
                        :class="{ 'is-invalid': errors['手機驗證碼'] }"
                        v-model="cardForm.OtpCode"
                      ></Field>
                      <ErrorMessage
                        name="手機驗證碼"
                        class="invalid-feedback"
                      ></ErrorMessage>
                    </div>
                    <div class="col-md-5 mb-3 mt-1">
                      <button
                        type="submit"
                        class="btn btn-primary"
                        @click.prevent="countMsg"
                        :disabled="$store.state.registerMsgSecond"
                      >
                        <span v-if="!$store.state.registerMsgSecond"
                          >獲取驗證碼</span
                        >
                        <span v-else class="count"
                          >{{ $store.state.registerMsgSecond }} 秒後
                          重新發送</span
                        >
                      </button>
                    </div>
                  </div>
                  <div class="row name d-flex align-items-end">
                    <div class="col-md-12 mb-3">
                      <label for="inputEmail4" class="form-label"
                        >身分證字號</label
                      >
                      <span class="text-primary">*</span>
                      <Field
                        name="身分證字號"
                        placeholder="身分證字號"
                        class="form-control"
                        :class="{ 'is-invalid': errors['身分證字號'] }"
                        v-model="cardForm.IdNo"
                        autocomplete="off"
                        type="text"
                        style="text-transform: uppercase;"
                        @change="uppercase"
                        :rules="checkId"
                      ></Field>
                      <ErrorMessage
                        name="身分證字號"
                        class="invalid-feedback"
                      ></ErrorMessage>
                    </div>
                  </div>
                  <div class="row email">
                    <div class="col-md-12 mb-3">
                      <label for="inputAddress" class="form-label"
                        >電子郵件</label
                      >
                      <span class="text-primary">*</span>
                      <Field
                        name="信箱"
                        placeholder="請輸入email"
                        type="text"
                        class="form-control py-2"
                        id="memberEmail"
                        autocomplete="off"
                        :class="{ 'is-invalid': errors['信箱'] }"
                        v-model="cardForm.Email"
                        :rules="checkEmail"
                      ></Field>
                      <ErrorMessage
                        name="信箱"
                        class="invalid-feedback"
                      ></ErrorMessage>
                      <p class="text-primary">{{ checkEmailMsg }}</p>
                    </div>
                  </div>
                  <div class="mb-3">
                    <label for="memberBirth" class="form-label">生日</label>
                    <span class="text-primary">*</span>
                    <div class="row g-2">
                      <div class="col">
                        <select
                          id="birthYear"
                          class="form-select"
                          v-model="memberBirth.year"
                          @change="getDay"
                        >
                          <option value="" selected >西元年</option>
                          <option
                            :value="year"
                            v-for="year in dateList.yearList"
                            :key="year"
                          >
                            {{ year }}
                          </option>
                        </select>
                      </div>
                      <div class="col">
                        <select
                          id="birthMonth"
                          class="form-select"
                          v-model="memberBirth.month"
                          @change="getDay"
                        >
                          <option value="" selected>月份</option>
                          <option
                            :value="month"
                            v-for="month in dateList.monthList"
                            :key="month"
                          >
                            {{ month }}
                          </option>
                        </select>
                      </div>
                      <div class="col">
                        <select
                          id="birthDate"
                          class="form-select"
                          v-model="memberBirth.day"
                        >
                          <option value="" selected>日</option>
                          <option
                            :value="day"
                            v-for="day in dateList.dayList"
                            :key="day"
                          >
                            {{ day }}
                          </option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="row password">
                    <div class="col-md-12 mb-3">
                      <label class="form-label" for="newPassword">密碼</label>
                      <span class="text-primary">*</span>
                      <div id="f">
                        <Field
                          name="密碼"
                          type="password"
                          class="form-control form_password"
                          placeholder="至少6碼且英數字混合"
                          :class="{ 'is-invalid': errors['密碼'] }"
                          autocomplete="off"
                          v-model="cardForm.SecretCode "
                          id="newPassword"
                          :rules="checkPwdRule"
                        ></Field>
                        <ErrorMessage
                          name="密碼"
                          class="invalid-feedback"
                        ></ErrorMessage>
                        <a
                          href="#"
                          @click.prevent="pwdCheck(isOldShow, $event)"
                          class="passwordImage position-absolute d-block"
                        >
                          <img
                            src="../assets/img/yesgo_icon26.svg"
                            v-if="isOldShow"
                          />
                          <img v-else src="../assets/img/yesgo_icon25.svg" />
                        </a>
                      </div>
                      <p class="text-primary">{{ password }}</p>
                    </div>
                  </div>
                  <div class="row doublecheck">
                    <div class="col-md-12 mb-3">
                      <label for="confirmPassword" class="form-label"
                        >確認密碼</label
                      >
                      <span class="text-primary">*</span>
                      <div id="f">
                        <Field
                          name="確認密碼"
                          type="password"
                          class="form-control form_confirm_password"
                          placeholder="至少6碼且英數字混合"
                          :class="{ 'is-invalid': errors['確認密碼'] }"
                          autocomplete="off"
                          v-model="confirmPassword"
                          id="confirmPassword"
                          :rules="confirmCardPwd"
                        ></Field>
                        <ErrorMessage
                          name="確認密碼"
                          class="invalid-feedback"
                        ></ErrorMessage>
                        <a
                          href="#"
                          @click.prevent="pwdCheck(isConfirmShow, $event)"
                          class="passwordImage position-absolute d-block"
                        >
                          <img
                            v-if="isConfirmShow"
                            src="../assets/img/yesgo_icon26.svg"
                          />
                          <img v-else src="../assets/img/yesgo_icon25.svg" />
                        </a>
                      </div>
                      <p class="text-primary">{{ confirmNotSame }}</p>
                    </div>
                  </div>
                  <div class="row verificationCode">
                    <div class="col-md-12">
                      <label for="inputState" class="form-label">驗證碼</label>
                      <div class="input-group">
                        <Field
                          name="驗證碼"
                          :class="{ 'is-invalid': errors['驗證碼'] }"
                          autocomplete="off"
                          type="text"
                          class="form-control z-index-10"
                          maxlength="4"
                          tabindex="3"
                          v-model="cardForm.Captcha"
                          rules="required"
                        />
                        <button
                          class="verifyBtn btn border px-3"
                          type="button"
                          @click.prevent="getValidCode"
                        >
                          <img
                            :src="validate.img"
                            style="width: 100px; height: 30px; margin-right: 8px;"
                          />
                          <img src="../assets/img/yesgo_icon27.svg" />
                        </button>
                        <ErrorMessage
                          name="驗證碼"
                          class="invalid-feedback"
                        ></ErrorMessage>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex justify-content-end text-muted fs-7 mt-1">
                    驗證碼不須區分大小寫
                  </div>
                  <div class="row term">
                    <div class="col-md-12 mt-2">
                      <div class="form-check py-1">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          id="inlineFormCheck1"
                          v-model="termsCard"
                        />
                        <label class="form-check-label" for="inlineFormCheck1">
                          我已詳閱並同意
                          <router-link to="/rights" class="text-primary"
                            >約定條款</router-link
                          >
                          以確保權益
                        </label>
                      </div>
                      <div class="confirm">
                        <button type="submit" class="btn btn-primary">
                          確認
                        </button>
                      </div>
                      <!-- <label class="mt-3 fs-5">
                        卡友會員帳號
                        <router-link
                          to="/register"
                          class="text-primary border fs-5 fs-xl-5 py-0 px-2"
                        >
                          請點此登入
                        </router-link>
                      </label> -->
                    </div>
                  </div>
                </div>
              </Form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- 會員登入modal -->
    <div
      class="modal"
      aria-hidden="true"
      aria-labelledby="exampleModalToggleLabel"
      ref="loginDom"
      id="exampleModalToggle"
    >
      <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
          <div class="modal-header align-items-end">
            <button
              type="button"
              class="btn-close"
              @click.prevent="myModal.hide()"
            ></button>
          </div>
          <div class="modal-body px-3 px-lg-6">
            <div class="container-fluid">
              <div class="row py-4 align-items-center mb-5 mt-3">
                <div class="col-lg-6">
                  <Form
                    class="form_registration pe-lg-4 pe-md-3"
                    method="POST"
                    v-slot="{ errors }"
                    @submit="login"
                  >
                    <div class="form_detail">
                      <div class="text-center">
                        <img
                          src="../assets/img/yesgo_icon02.svg"
                          alt=""
                          id="logInImage"
                          class="d-block mx-auto"
                        />
                        <span class="registraion">會員登入</span>
                      </div>
                      <div class="row phone">
                        <div class="col-md-12">
                          <label class="form-label">帳號</label>
                          <Field
                            name="新帳號"
                            type="tel"
                            class="form-control"
                            placeholder="請輸入手機號碼，如:0987654352"
                            autoCompleteType="disabled"
                            :class="{ 'is-invalid': errors['新帳號'] }"
                            v-model="newLogin.PhoneNum"
                            autocomplete="off"
                            tabindex="1"
                            :rules="isPhone"
                          />
                          <ErrorMessage
                            name="新帳號"
                            class="invalid-feedback"
                          ></ErrorMessage>
                        </div>
                      </div>
                      <div class="row password">
                        <div class="col-md-12">
                          <label class="form-label">密碼</label>
                          <div id="f">
                            <Field
                              name="登入密碼"
                              type="password"
                              class="form-control form_password"
                              placeholder="請輸入密碼"
                              :class="{
                                'is-invalid': errors['登入密碼']
                              }"
                              v-model.trim="newLogin.SecretCode"
                              tabindex="2"
                              :rules="checkPwdRule"
                            />
                            <ErrorMessage
                              name="登入密碼"
                              class="invalid-feedback"
                            ></ErrorMessage>
                            <a
                              href="#"
                              @click.prevent="pwdCheck(isShow, $event)"
                              class="passwordImage position-absolute d-block"
                            >
                              <img
                                v-if="isShow"
                                src="../assets/img/yesgo_icon26.svg"
                              />
                              <img
                                v-else
                                src="../assets/img/yesgo_icon25.svg"
                              />
                            </a>
                          </div>
                          <div class="d-flex justify-content-between">
                            <div class="form-check">
                              <input
                                class="form-check-input"
                                type="checkbox"
                                id="rememberAccount"
                                v-model="newLogin.RememberMe"
                              />
                              <label
                                class="form-check-label"
                                for="rememberAccount"
                              >
                                記住帳號
                              </label>
                            </div>
                            <a
                              href="#"
                              @click.prevent="toForgetPassword"
                              class="forgot-password"
                            >
                              忘記密碼
                            </a>
                          </div>
                        </div>
                      </div>
                      <div class="row verification">
                        <div class="col-md-12">
                          <label for="inputState" class="form-label"
                            >驗證碼</label
                          >
                          <div class="input-group">
                            <Field
                              name="驗證碼"
                              :class="{ 'is-invalid': errors['驗證碼'] }"
                              autocomplete="off"
                              type="text"
                              class="form-control z-index-10"
                              maxlength="4"
                              tabindex="3"
                              v-model="newLogin.Captcha"
                            />
                            <button
                              class="verifyBtn btn border px-3"
                              type="button"
                              @click.prevent="getValidCode"
                            >
                              <img
                                :src="validate.img"
                                id="imgInitNewValidCode"
                                style="width: 100px; height: 30px; margin-right: 8px;"
                              />
                              <img src="../assets/img/yesgo_icon27.svg" />
                            </button>
                            <ErrorMessage
                              name="驗證碼"
                              class="invalid-feedback"
                            ></ErrorMessage>
                          </div>
                        </div>
                      </div>
                      <div
                        class="d-flex justify-content-end text-muted fs-7 mb-2"
                      >
                        驗證碼不須區分大小寫
                      </div>
                      <div class="row">
                        <div class="col-md-12">
                          <button
                            type="submit"
                            class="btn btn-primary col-md-12 text-white"
                          >
                            登入
                          </button>
                        </div>
                        <div class="col-md-1 ms-auto">
                          <a
                            class="register text-secondary d-flex justify-content-end text-nowrap mt-3"
                            href="#"
                            @click.prevent="toRegister"
                          >
                            註冊
                          </a>
                        </div>
                      </div>
                    </div>
                  </Form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- 舊會員登入modal -->
    <div
      class="modal"
      id="exampleModalToggle2"
      ref="oldLoginDom"
    >
      <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="btn-close"
              @click.prevent="myOldModal.hide()"
            ></button>
          </div>
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row justify-content-center my-5">
                <div class="col-lg-6">
                  <Form
                    class="form_registration"
                    method="POST"
                    v-slot="{ errors }"
                    @submit="oldMemberLogin"
                  >
                    <div class="form_detail">
                      <div class="text-center">
                        <img
                          src="../assets/img/yesgo_icon02.svg"
                          alt=""
                          id="logInImage"
                          class="d-block mx-auto"
                        />
                        <span class="registraion">舊會員登入</span>
                      </div>
                      <div class="row phone">
                        <div class="col-md-12">
                          <label class="form-label">帳號</label>
                          <Field
                            type="text"
                            v-model="oldLogin.Account"
                            class="form-control"
                            :class="{ 'is-invalid': errors['舊帳號'] }"
                            placeholder="請輸入手機號碼/身分證字號/Email"
                            name="舊帳號"
                            autocomplete="off"
                            tabindex="1"
                            :rules="isaccount"
                          ></Field>
                          <ErrorMessage
                            name="舊帳號"
                            class="invalid-feedback"
                          ></ErrorMessage>
                        </div>
                      </div>
                      <div class="row password">
                        <div class="col-md-12">
                          <label class="form-label">密碼</label>
                          <div id="f">
                            <Field
                              name="舊會員登入密碼"
                              type="password"
                              class="form-control form_password"
                              placeholder="請輸入密碼"
                              :class="{
                                'is-invalid': errors['舊會員登入密碼']
                              }"
                              v-model.trim="oldLogin.SecretCode"
                              autocomplete="off"
                              tabindex="2"
                              :rules="checkPwdRule"
                            ></Field>
                            <ErrorMessage
                              name="舊會員登入密碼"
                              class="invalid-feedback"
                            ></ErrorMessage>
                            <a
                              href="#"
                              @click.prevent="
                                isOldShow = !isOldShow;
                                pwdCheck(isOldShow, $event)
                              "
                              class="passwordImage position-absolute d-block"
                            >
                              <img
                                v-if="isOldShow"
                                src="../assets/img/yesgo_icon26.svg"
                              />
                              <img
                                v-else
                                src="../assets/img/yesgo_icon25.svg"
                              />
                            </a>
                          </div>
                          <div class="d-flex justify-content-between">
                            <div class="form-check" v-if="showRememberMe">
                              <input
                                class="form-check-input"
                                type="checkbox"
                                id="rememberOldAccount"
                                v-model="oldLogin.RememberMe"
                              />
                              <label
                                class="form-check-label"
                                for="rememberOldAccount"
                              >
                                記住帳號
                              </label>
                            </div>
                            <a
                              class="forgot-password"
                              href="#"
                              @click.prevent="toForgetPassword"
                            >
                              忘記密碼
                            </a>
                          </div>
                        </div>
                      </div>
                      <div class="row verification">
                        <div class="col-md-12">
                          <label for="inputState" class="form-label"
                            >驗證碼</label
                          >
                          <div class="input-group">
                            <Field
                              type="text"
                              class="form-control z-index-10"
                              v-model="oldLogin.Captcha"
                              maxlength="4"
                              tabindex="3"
                              autocomplete="off"
                              name="驗證碼"
                              :class="{ 'is-invalid': errors['驗證碼'] }"
                            />
                            <button
                              class="verifyBtn btn border"
                              type="button"
                              @click.prevent="getValidCode"
                            >
                              <img
                                :src="validate.img"
                                id="imgInitNewValidCode"
                                style="width: 100px; height: 30px; margin-right: 8px;"
                              />
                              <img
                                src="../assets/img/yesgo_icon27.svg"
                              />
                            </button>
                            <ErrorMessage
                              name="驗證碼"
                              class="invalid-feedback"
                            ></ErrorMessage>
                          </div>
                        </div>
                      </div>
                      <div class="d-flex justify-content-end text-muted fs-7 mb-2">
                        驗證碼不須區分大小寫
                      </div>
                      <div class="row">
                        <div class="col-md-12">
                          <button
                            type="submit"
                            class="btn btn-primary col-md-12 text-white"
                          >
                            登入
                          </button>
                        </div>
                      </div>
                    </div>
                  </Form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import member from '../assets/js/member'
import bootstrap from 'bootstrap/dist/js/bootstrap.bundle.js'
import ValidSvc from '../assets/js/validate-service.js'

export default {
  data () {
    return {
      isShowRegisterPwd: false,
      islogin: localStorage.getItem('yesgo') ? 1 : 0,
      validate: {},
      myModal: '',
      myOldModal: '',
      // ? 會員登入
      newLogin: {
        PhoneNum: '',
        SecretCode: '',
        RememberMe: false,
        Captcha: '',
        ValidTransactionId: ''
      },
      // ? 舊會員登入
      oldLogin: {
        Account: '',
        SecretCode: '',
        Captcha: '',
        ValidTransactionId: '',
        RememberMe: false
      },
      // ? 註冊簡訊驗證碼
      msg: {
        phoneNumber: '',
        otpType: '1'
      },
      // ? 註冊
      form: {
        FullName: '',
        Email: '',
        PhoneNum: '',
        OtpCode: '',
        SecretCode: '',
        Captcha: '',
        RememberMe: false,
        IsSubscribe: true,
        TransactionId: '',
        ValidTransactionId: ''
      },
      // ? 卡友註冊
      cardForm: {
        IdNo: '',
        BirthDay: '',
        PhoneNum: '',
        SecretCode: '',
        TransactionId: '',
        OtpCode: '',
        Email: '',
        Captcha: '',
        ValidTransactionId: '',
        RememberMe: false
      },
      dateList: {
        // ?日期選單
        yearList: [],
        monthList: [],
        dayList: []
      },
      memberBirth: {
        // ?使用者輸入的出生年月日
        year: '',
        month: '',
        day: ''
      },
      terms: false,
      termsCard: false
    }
  },
  methods: {
    getYearMonth () {
      // ? 產生生日"年"、"月"選單
      const year = new Date()
      for (let i = 1930; i < year.getFullYear() + 1; i++) {
        this.dateList.yearList.push(i)
      }
      for (let i = 1; i < 13; i++) {
        if (i < 10) {
          this.dateList.monthList.push('0' + i)
        } else {
          this.dateList.monthList.push(i)
        }
      }
    },
    getDay () {
      // ? 產生生日"日"選單
      this.dateList.dayList = []
      // ?清空西元年，月日一併清空
      if (!this.memberBirth.year) {
        this.memberBirth.month = ''
        this.memberBirth.day = ''
        return
      }
      // ?清空月，日一併清空
      if (!this.memberBirth.month) {
        this.memberBirth.day = ''
        return
      }
      // ? 產生生日"日"選單
      const days = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]
      if (this.memberBirth.year % 4 === 0) {
        days[1] = 29
      }
      for (let i = 1; i < days[parseInt(this.memberBirth.month) - 1] + 1; i++) {
        if (i < 10) {
          this.dateList.dayList.push('0' + i)
        } else {
          this.dateList.dayList.push(i)
        }
      }
    },
    // ? 取得圖形驗證碼
    async getValidCode () {
      this.validate = await member.getValidateCode()
      this.form.ValidTransactionId = this.validate.validTransactionId
      this.cardForm.ValidTransactionId = this.validate.validTransactionId
      this.newLogin.ValidTransactionId = this.validate.validTransactionId
      this.oldLogin.ValidTransactionId = this.validate.validTransactionId
    },
    // ? 新會員登入
    async login () {
      if (await member.login('NewLogIn', this.newLogin, this.myModal)) {
        this.$router.go()
      } else {
        this.getValidCode()
      }
    },
    // ? 舊會員登入
    async oldMemberLogin () {
      if (await member.login('OldLogIn', this.oldLogin, this.myOldModal)) {
        this.$router.go()
      } else {
        this.getValidCode()
      }
    },
    // ? 登出
    async logout () {
      if (await member.logout()) {
        this.$router.go()
      }
    },
    // ? 註冊取得簡訊驗證碼
    async countMsg () {
      if (this.form.PhoneNum) {
        this.msg.phoneNumber = this.form.PhoneNum
      }
      if (this.cardForm.PhoneNum) {
        this.msg.phoneNumber = this.cardForm.PhoneNum
      }
      const res = await member.getMsgCode(this.msg)
      this.form.TransactionId = res.transactionId
      this.cardForm.TransactionId = res.transactionId
    },
    // ? 一般註冊
    async register () {
      const response = ValidSvc.registerSubmit(this.terms)
      if (response === false) {
        return
      }
      // ? 打 API
      if (await member.register('register', this.form)) {
        this.$router.push('/')
      } else {
        this.getValidCode()
      }
    },
    // ? 卡友註冊
    async cardRegister () {
      this.cardForm.BirthDay = `${this.memberBirth.year}${this.memberBirth.month}${this.memberBirth.day}`
      const responseBirth = ValidSvc.CheckBirth(this.memberBirth)
      if (responseBirth === false) {
        return
      }
      const response = ValidSvc.registerSubmit(this.termsCard)
      if (response === false) {
        return
      }
      // ? 打 API
      if (await member.register('RegisterForUB', this.cardForm)) {
        this.$router.push('/')
      } else {
        this.getValidCode()
      }
    },
    //* 姓名格式
    checkName (value) {
      return ValidSvc.CheckName(value)
    },
    //* 檢查email格式
    checkEmail (email) {
      return ValidSvc.CheckEmail(email)
    },
    //* 檢查密碼格式
    checkPwdRule (password) {
      return ValidSvc.CheckPwd(password)
    },
    //* 密碼確認格式
    confirmPwd (confirmPwd, pwd) {
      return ValidSvc.ConfirmPwd(confirmPwd, this.form.SecretCode)
    },
    //* 檢查卡友密碼格式
    confirmCardPwd (confirmPwd, pwd) {
      return ValidSvc.ConfirmPwd(confirmPwd, this.cardForm.SecretCode)
    },
    //* 手機號碼格式
    isPhone (phoneNum) {
      return ValidSvc.CheckMobileNum(phoneNum)
    },
    //* 舊會員登入驗證(身分證/Email/手機號碼)
    isaccount (Account) {
      const oldAccounts = ValidSvc.CheckAccount(Account)
      if (oldAccounts === 'id') {
        this.oldLogin.Account = this.oldLogin.Account.toUpperCase()
        // ? 告知可以通過此驗證
        return true
      } else {
        return oldAccounts
      }
    },
    //* 身分證格式驗證(自動變成大寫)
    checkId (id) {
      if (ValidSvc.CheckId(id)) {
        this.cardForm.IdNo = this.cardForm.IdNo.toUpperCase()
      }
      return ValidSvc.CheckId(id)
    }
  },
  mounted () {
    this.getValidCode()
    this.getYearMonth()
    this.myModal = new bootstrap.Modal(this.$refs.loginDom, {
      backdrop: 'static'
    })
    this.myOldModal = new bootstrap.Modal(this.$refs.oldLoginDom, { backdrop: 'static' })
  }
}
</script>
