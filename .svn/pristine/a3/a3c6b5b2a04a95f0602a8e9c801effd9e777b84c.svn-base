<template>
  <div class="bg-newyeargift overflow-hidden">
    <!-- 主視覺 PC-->
    <div class="position-relative d-none d-lg-block overflow-hidden text-center">
      <img src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/PC_KV_bg.jpg" alt="福兔迎祥_新春禮盒" class="img-fluid">
      <img src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/PC_KV_1.png" alt="福兔迎祥_新春禮盒" class="img-fluid position-absolute bottom-0 start-0 z-index-3">
      <!-- 標題 -->
      <img class="bannerAnimate giftTitle img-fluid position-absolute start-50 translate-middle-x w-45" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/KV_MB_title.png" alt="福兔迎祥_新春禮盒 標題">
    </div>
    <!-- 主視覺 MC-->
    <div class="position-relative d-lg-none">
      <img src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/KV_MB_bg.jpg" alt="福兔迎祥_新春禮盒" class="img-fluid">
      <img src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/KV_MB_1.png" alt="福兔迎祥_新春禮盒" class="img-fluid position-absolute bottom-0 start-0 z-index-3">
      <!-- 標題 -->
      <img class="bannerAnimate_m giftTitle img-fluid position-absolute start-50 translate-middle-x w-70" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/PC_KV_TITLE_02.png" alt="福兔迎祥_新春禮盒 標題">
    </div>
    <!-- 優惠訊息 -->
    <div class="bg-event py-3 py-lg-4">
      <div class="container-fluid">
        <!-- 優惠訊息 PC -->
        <div class="bg-special d-none d-lg-block">
          <!-- 優惠訊息上方 2 活動 -->
          <div class="d-flex w-45 mx-auto pt-11 pb-5">
            <a v-if="eventList[0]" href="#" @click.prevent="recordClickHeight(eventList[0].targetUrl)" class="gift-hover">
              <img class="img-fluid" :src="eventList[0].image" alt="優惠訊息">
            </a>
            <a v-if="eventList[1]" href="#" @click.prevent="recordClickHeight(eventList[1].targetUrl)" class="gift-hover">
              <img class="img-fluid" :src="eventList[1].image" alt="優惠訊息">
            </a>
          </div>
          <!-- 優惠訊息下方 3 活動 -->
          <div class="d-flex w-60 pt-11 py-5 justify-content-between mx-auto">
            <a v-if="eventList[2]" href="#" @click.prevent="recordClickHeight(eventList[2].targetUrl)" class="gift-hover pe-2">
              <img class="img-fluid" :src="eventList[2].image" alt="優惠訊息">
            </a>
            <a v-if="eventList[3]" href="#" @click.prevent="recordClickHeight(eventList[3].targetUrl)" class="gift-hover pe-2">
              <img class="img-fluid" :src="eventList[3].image" alt="優惠訊息">
            </a>
            <a v-if="eventList[4]" href="#" @click.prevent="recordClickHeight(eventList[4].targetUrl)" class="gift-hover">
              <img class="img-fluid" :src="eventList[4].image" alt="優惠訊息">
            </a>
          </div>
        </div>
        <!-- 優惠訊息 MB -->
        <div class="bg-special d-lg-none">
          <!-- 優惠訊息上方 2 活動 -->
          <div class="special-areaA-m d-flex w-75 mx-auto">
            <a v-if="eventList[0]" href="#" @click.prevent="recordClickHeight(eventList[0].targetUrl)">
              <img class="img-fluid" :src="eventList[0].image" alt="優惠訊息">
            </a>
            <a v-if="eventList[1]" href="#" @click.prevent="recordClickHeight(eventList[1].targetUrl)">
              <img class="img-fluid" :src="eventList[1].image" alt="優惠訊息">
            </a>
          </div>
          <!-- 優惠訊息下方 3 活動 -->
          <div class="special-areaB-m d-flex w-90 mx-auto">
            <a v-if="eventList[2]" href="#" @click.prevent="recordClickHeight(eventList[2].targetUrl)" class="pe-2">
              <img class="img-fluid" :src="eventList[2].image" alt="優惠訊息">
            </a>
            <a v-if="eventList[3]" href="#" @click.prevent="recordClickHeight(eventList[3].targetUrl)" class="pe-2">
              <img class="img-fluid" :src="eventList[3].image" alt="優惠訊息">
            </a>
            <a v-if="eventList[4]" href="#" @click.prevent="recordClickHeight(eventList[4].targetUrl)">
              <img class="img-fluid" :src="eventList[4].image" alt="優惠訊息">
            </a>
          </div>
        </div>
      </div>
    </div>
    <!-- 經典好評 -->
    <div class="bg-classic py-3 py-lg-5">
      <div class="container-fluid px-0 px-md-4 px-xl-9">
        <h2>
          <img class="img-fluid d-block d-lg-none mx-auto w-60 mb-3" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/MB_3_title.png" alt="經典好評標題">
          <img class="img-fluid d-none d-lg-block mx-auto w-35" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/PC_3_title.png" alt="經典好評標題">
        </h2>
        <div class="bg-classic-content px-5 px-sm-6 px-md-5">
          <div class="row justify-content-center">
            <div v-if="classicList[0]" class="col-12 col-lg-6 d-flex justify-content-center mb-4 mb-lg-0">
              <a href="#" @click.prevent="recordClickHeight(classicList[0].targetUrl)" class="gift-hover">
                <img class="img-fluid" :src="classicList[0].image" alt="經典好評商品">
              </a>
            </div>
            <div v-if="classicList[1]" class="col-12 col-lg-6 d-flex justify-content-center">
              <a href="#" @click.prevent="recordClickHeight(classicList[1].targetUrl)" class="gift-hover">
                <img class="img-fluid" :src="classicList[1].image" alt="經典好評商品">
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- 精選推薦 -->
    <div v-if="giftList" class="bg-product-2 py-4 py-lg-5">
      <div class="container-fluid">
        <img class="img-fluid d-none d-lg-block mx-auto" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/PC_3_frame1.png" alt="精選推薦標題">
        <img class="img-fluid d-block d-lg-none mx-auto" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/MB_3_frame1.png" alt="精選推薦標題">
        <div class="bg-product-content-2">
          <div class="row gx-3">
            <div class="col-6 col-lg-3 mb-3 mb-lg-4" v-for="gift in giftList.products" :key="gift">
              <router-link :to="`/productboard/product/${gift.productId}`">
                <div class="card prd-shadow gift-hover rounded-0 h-100 border-0 d-flex flex-column justify-content-between" :class="{ 'sold-out': gift.stock === 0 }">
                  <img :src="gift.productImage" class="img-fluid p-1 p-md-2" :alt="gift.productName">
                  <div class="px-1 pb-1 px-md-2 pb-md-2 pt-0">
                    <p class="card-text text-dark text-center mt-0 prd-name fs-6">{{ gift.productName }}</p>
                    <div class="d-flex justify-content-center align-items-end mb-1 mb-md-2">
                      <del class="sell-oldprice text-dark text-nowrap fs-7 fs-md-6 fs-lg-7 fs-xl-6 mb-1 mb-lg-1 mb-xl-0 mb-xxl-2 me-2 me-md-3">
                        ${{ $currency.currency(gift.oldPrice) }}
                      </del>
                      <span class="prd-price text-nowrap fs-7 fs-md-6 fs-lg-7 fs-xxl-6">
                        特價 $<span class="sell-price">{{ $currency.currency(gift.price) }}</span>
                      </span>
                    </div>
                    <div class="prd-btn text-center text-white py-2 fs-7 fs-md-6 fs-lg-7 fs-xl-6">立即搶購</div>
                  </div>
                </div>
              </router-link>
            </div>
          </div>
        </div>
        <img class="img-fluid d-none d-lg-block mx-auto" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/PC_3_frame3.png" alt="精選推薦底部">
        <img class="img-fluid d-block d-lg-none mx-auto" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/MB_3_frame3.png" alt="精選推薦底部">
      </div>
    </div>
    <!-- 大家都在買 -->
    <div v-if="allBuyList" class="bg-product-3 py-4 py-lg-5">
      <div class="container-fluid position-relative">
        <img class="img-fluid d-none d-lg-block mx-auto" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/PC_4_frame1.png" alt="大家都在買標題">
        <img class="img-fluid d-block d-lg-none mx-auto" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/MB_4_frame1.png" alt="大家都在買標題">
        <div class="bg-product-content-3">
          <div class="row gx-3">
            <div class="col-6 col-lg-3 mb-3 mb-lg-4" v-for="gift in allBuyList.products" :key="gift">
              <router-link :to="`/productboard/product/${gift.productId}`">
                <div class="card prd-shadow gift-hover rounded-0 h-100  border-0 d-flex flex-column justify-content-between" :class="{ 'sold-out': gift.stock === 0 }">
                  <img :src="gift.productImage" class="img-fluid p-1 p-md-2" :alt="gift.productName">
                  <div class="px-1 pb-1 px-md-2 pb-md-2 pt-0">
                    <p class="card-text text-dark text-center mt-0 prd-name fs-6">{{ gift.productName }}</p>
                    <div class="d-flex justify-content-center align-items-end">
                      <del class="text-dark text-nowrap fs-7 fs-md-6 fs-lg-7 fs-xl-6 mb-1 mb-xl-0 mb-xxl-2 me-2 me-md-3">
                        ${{ $currency.currency(gift.oldPrice) }}
                      </del>
                      <span class="prd-price text-nowrap fs-7 fs-md-6 fs-lg-7 fs-xxl-6">
                        特價 $<span class="sell-price">{{ $currency.currency(gift.price) }}</span>
                      </span>
                    </div>
                    <!-- <div class="prd-btn text-center text-white py-2 fs-7 fs-md-6 fs-lg-7 fs-xl-6">立即搶購</div> -->
                  </div>
                </div>
              </router-link>
            </div>
          </div>
        </div>
        <img class="img-fluid d-none d-lg-block mx-auto" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/PC_4_frame3.png" alt="大家都在買底部">
        <img class="img-fluid d-block d-lg-none mx-auto" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/MB_4_frame3.png" alt="大家都在買底部">
        <img class="rabbit1 position-absolute img-fluid w-25 w-lg-15" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/rabbit_4_img1.png" alt="大家都在買-兔1">
        <img class="rabbit2 position-absolute img-fluid w-25 w-lg-15" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/rabbit_4_img2.png" alt="大家都在買-兔2">
      </div>
      <!-- 看更多 -->
      <div class="text-center pt-4 pb-5">
        <router-link to="/">
          <img class="d-lg-none w-50" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/MB_footer-btn.png" alt="看更多">
          <img class="d-none d-lg-inline" src="https://yesgoimages.s3.ap-northeast-1.amazonaws.com/yesgoevent/newyeargift/PC_footer-btn.png" alt="看更多">
        </router-link>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  data () {
    return {
      giftList: '',
      allBuyList: '',
      eventList: '',
      eventList_m: '',
      classicList: ''
    }
  },
  methods: {
    /* 精選推薦 & 大家都在買 */
    getGiftList () {
      const url = `${process.env.VUE_APP_API}/api/product/eventproducts?code=gift_C`
      this.$http.get(url)
        .then((res) => {
          if (res.data.rtnCode === 0) {
            res.data.info.forEach((item) => {
              if (item.code === 'gift_C_1') {
                this.giftList = item
              } else if (item.code === 'gift_C_2') {
                this.allBuyList = item
              }
            })

            // ?高度返回
            if (this.$store.state.recordEventReadHeight) {
              // ? 若有點擊產品紀錄，則記錄高度供上一頁返回
              setTimeout(() => {
                // ?資料高度生成需要時間，利用setTimeOut讓視窗滑動不同步，才能順利執行
                window.scrollTo(0, this.$store.state.recordEventReadHeight)
                this.$store.commit('getEventRecordHeight', '')
              }, 500)
            } else {
              this.checkLocalHeight()
            }
          }
        })
    },
    /* 活動 */
    getEventList () {
      const url = `${process.env.VUE_APP_API}/api/widgets/activitybanner?code=gift_A`
      this.$http.get(url)
        .then((res) => {
          if (res.data.rtnCode === 0) {
            this.eventList = res.data.info
          }
        })
      const urlm = `${process.env.VUE_APP_API}/api/widgets/activitybanner?code=gift_m_A`
      this.$http.get(urlm)
        .then((res) => {
          if (res.data.rtnCode === 0) {
            this.eventList_m = res.data.info
          }
        })
    },
    /* 經典好評 */
    getClassicList () {
      const url = `${process.env.VUE_APP_API}/api/widgets/activitybanner?code=gift_B`
      this.$http.get(url)
        .then((res) => {
          if (res.data.rtnCode === 0) {
            this.classicList = res.data.info
          }
        })
    },
    // ?小電視及看更多記錄高度
    recordClickHeight (url) {
      // ?點擊產品觸發紀錄瀏覽高度於LocalStorage
      const scrollYHeight = window.scrollY
      localStorage.setItem('clickNYgift', scrollYHeight)
      setTimeout(() => {
        window.location = url
      }, 500)
    },
    checkLocalHeight () {
      // ?檢查LocalStorage
      if (window.localStorage.getItem('clickNYgift')) {
        const globalheight = window.localStorage.getItem('clickNYgift')
        setTimeout(() => {
          window.scrollTo(0, globalheight)
        }, 300)
        localStorage.removeItem('clickNYgift')
      }
    },
    // ?點擊產品觸發紀錄瀏覽高度
    recordHeight () {
      if (this.$store.state.recordEventReadHeight) {
        setTimeout(() => [
          // ?資料高度生成需要時間，利用setTimeOut讓視窗滑動不同步，才能順利執行
          window.scrollTo(0, this.$store.state.recordEventReadHeight)
        ], 500)
      }
    }
  },
  watch: {
    $route (to, from) {
      if (to.fullPath.match('/productboard/') || to.fullPath === '/') {
        const recordHeight = window.scrollY
        this.$store.commit('getEventRecordHeight', recordHeight)
      } else {
        this.$store.commit('getEventRecordHeight', '')
      }
    }
  },
  mounted () {
    this.getEventList()
    this.getClassicList()
    this.getGiftList()
  }
}
</script>

<style lang="scss" scoped>
@import '@/assets/scss/activity/newyeargift/_site.scss';
</style>
